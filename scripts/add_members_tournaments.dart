import 'dart:io';
import 'dart:math';
import 'package:supabase/supabase.dart';

Future<void> main() async {
  print('üë•üèÜ TH√äM TH√ÄNH VI√äN & GI·∫¢I ƒê·∫§U CHO CLUBS...\n');

  const supabaseUrl = 'https://mogjjvscxjwvhtpkrlqr.supabase.co';
  const serviceKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vZ2pqdnNjeGp3dmh0cGtybHFyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzkxOTU4MCwiZXhwIjoyMDczNDk1NTgwfQ.T2ntQv-z2EL4mkGb9b3QyXM3dT8pAOFSPKvqWPd7Xoo';

  try {
    final supabase = SupabaseClient(supabaseUrl, serviceKey);
    print('‚úÖ K·∫øt n·ªëi Supabase th√†nh c√¥ng!\n');

    // 1. L·∫•y danh s√°ch clubs
    print('üìã 1. L·∫§Y DANH S√ÅCH CLUBS:');
    print('===========================');
    
    final clubs = await supabase
        .from('clubs')
        .select('id, name')
        .order('name');
    
    print('   T√¨m th·∫•y ${clubs.length} clubs\n');
    
    // 2. T·∫°o d·ªØ li·ªáu th√†nh vi√™n ƒëa d·∫°ng
    print('üë• 2. T·∫†O TH√ÄNH VI√äN ƒêA D·∫†NG:');
    print('==============================');
    
    final memberTemplates = [
      // Golden Billiards Club Members (Professional Style)
      {
        'name': 'Nguy·ªÖn VƒÉn Minh',
        'avatar': 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Pro',
        'years_experience': 8,
        'specialty': 'English 8-ball',
        'bio': 'C·ª±u v√¥ ƒë·ªãch gi·∫£i bi-a qu·ªëc gia, chuy√™n gia English 8-ball'
      },
      {
        'name': 'Tr·∫ßn Th·ªã H∆∞∆°ng',
        'avatar': 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Advanced',
        'years_experience': 5,
        'specialty': '9-ball',
        'bio': 'N·ªØ tuy·ªÉn th·ªß xu·∫•t s·∫Øc, th√†nh t√≠ch ·∫•n t∆∞·ª£ng ·ªü gi·∫£i 9-ball'
      },
      {
        'name': 'L√™ Ho√†ng Nam',
        'avatar': 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Intermediate',
        'years_experience': 3,
        'specialty': 'Carom',
        'bio': 'ƒêam m√™ bi-a carom, k·ªπ thu·∫≠t t·∫•n c√¥ng s·∫Øc b√©n'
      },
      {
        'name': 'Ph·∫°m Minh Tu·∫•n',
        'avatar': 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Advanced',
        'years_experience': 6,
        'specialty': 'Snooker',
        'bio': 'Chuy√™n gia snooker v·ªõi l·ªëi ch∆°i t√≠nh to√°n ch√≠nh x√°c'
      },
      
      // SABO Arena Central Members (Modern Style)
      {
        'name': 'ƒê·∫∑ng Vi·ªát Anh',
        'avatar': 'https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Pro',
        'years_experience': 10,
        'specialty': 'Tournament',
        'bio': 'T·ªï ch·ª©c v√† tham gia nhi·ªÅu gi·∫£i ƒë·∫•u chuy√™n nghi·ªáp'
      },
      {
        'name': 'V√µ Th·ªã Mai',
        'avatar': 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Advanced',
        'years_experience': 4,
        'specialty': 'Speed Pool',
        'bio': 'N·ªØ v·∫≠n ƒë·ªông vi√™n speed pool h√†ng ƒë·∫ßu mi·ªÅn Nam'
      },
      {
        'name': 'B√πi Thanh Long',
        'avatar': 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Intermediate',
        'years_experience': 2,
        'specialty': '8-ball',
        'bio': 'T√†i nƒÉng tr·∫ª v·ªõi phong c√°ch ch∆°i nƒÉng ƒë·ªông'
      },
      {
        'name': 'Ho√†ng Th·ªã Lan',
        'avatar': 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face',
        'skill_level': 'Advanced',
        'years_experience': 7,
        'specialty': 'Trick Shot',
        'bio': 'Ngh·ªá sƒ© bi-a v·ªõi nh·ªØng pha trick shot ngo·∫°n m·ª•c'
      },
    ];

    // 3. Th√™m th√†nh vi√™n v√†o clubs
    int memberCount = 0;
    final random = Random();
    
    for (int i = 0; i < clubs.length; i++) {
      final club = clubs[i];
      final clubId = club['id'];
      final clubName = club['name'];
      
      print('   üè¢ $clubName:');
      
      // M·ªói club c√≥ 4 th√†nh vi√™n
      final startIndex = i * 4;
      for (int j = 0; j < 4; j++) {
        final member = memberTemplates[startIndex + j];
        
        try {
          // T·∫°o user profile tr∆∞·ªõc
          final userId = supabase.rpc('generate_uuid').single;
          
          await supabase
              .from('user_profiles')
              .insert({
                'id': userId,
                'full_name': member['name'],
                'avatar_url': member['avatar'],
                'bio': member['bio'],
                'skill_level': member['skill_level'],
                'years_experience': member['years_experience'],
                'specialty': member['specialty'],
                'location': clubName.contains('Golden') ? 'Qu·∫≠n 1, TP.HCM' : 'Qu·∫≠n 3, TP.HCM',
                'phone': '+84 ${90 + random.nextInt(9)}${random.nextInt(10)}${random.nextInt(10)}${random.nextInt(10)}${random.nextInt(10)}${random.nextInt(10)}${random.nextInt(10)}${random.nextInt(10)}',
                'rating': 4.0 + random.nextDouble() * 1.0,
                'total_matches': 50 + random.nextInt(200),
                'wins': 30 + random.nextInt(100),
                'created_at': DateTime.now().toIso8601String(),
              });
          
          // Th√™m v√†o club_members
          await supabase
              .from('club_members')
              .insert({
                'club_id': clubId,
                'user_id': userId,
                'role': j == 0 ? 'owner' : (j == 1 ? 'admin' : 'member'),
                'joined_at': DateTime.now().subtract(Duration(days: random.nextInt(365))).toIso8601String(),
              });
          
          print('      ‚úÖ ${member['name']} - ${member['skill_level']} (${member['specialty']})');
          memberCount++;
          
        } catch (e) {
          print('      ‚ùå ${member['name']}: L·ªói - $e');
        }
      }
      print('');
    }

    // 4. T·∫°o tournaments ƒëa d·∫°ng
    print('üèÜ 3. T·∫†O GI·∫¢I ƒê·∫§U ƒêA D·∫†NG:');
    print('============================');
    
    final tournamentTemplates = [
      // Golden Billiards Club Tournaments
      {
        'name': 'Golden Cup 2025',
        'description': 'Gi·∫£i bi-a English 8-ball chuy√™n nghi·ªáp h√†ng nƒÉm v·ªõi gi·∫£i th∆∞·ªüng h·∫•p d·∫´n',
        'image_url': 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=600&h=400&fit=crop',
        'game_type': 'English 8-ball',
        'max_participants': 32,
        'entry_fee': 500000,
        'prize_pool': 15000000,
        'start_date': '2025-10-15',
        'registration_deadline': '2025-10-10',
        'status': 'upcoming'
      },
      {
        'name': 'Ladies Night Championship',
        'description': 'Gi·∫£i ƒë·∫•u d√†nh ri√™ng cho n·ªØ v·∫≠n ƒë·ªông vi√™n bi-a v·ªõi nhi·ªÅu ho·∫°t ƒë·ªông h·∫•p d·∫´n',
        'image_url': 'https://images.unsplash.com/photo-1594736797933-d0601ba2fe65?w=600&h=400&fit=crop',
        'game_type': '9-ball',
        'max_participants': 16,
        'entry_fee': 300000,
        'prize_pool': 8000000,
        'start_date': '2025-11-20',
        'registration_deadline': '2025-11-15',
        'status': 'upcoming'
      },
      
      // SABO Arena Central Tournaments
      {
        'name': 'SABO Pro Series',
        'description': 'Gi·∫£i ƒë·∫•u chuy√™n nghi·ªáp v·ªõi format thi ƒë·∫•u hi·ªán ƒë·∫°i v√† livestream tr·ª±c ti·∫øp',
        'image_url': 'https://images.unsplash.com/photo-1574631806042-182f10c4a017?w=600&h=400&fit=crop',
        'game_type': 'Tournament Mix',
        'max_participants': 64,
        'entry_fee': 1000000,
        'prize_pool': 50000000,
        'start_date': '2025-12-01',
        'registration_deadline': '2025-11-25',
        'status': 'upcoming'
      },
      {
        'name': 'Speed Pool Challenge',
        'description': 'Th·ª≠ th√°ch t·ªëc ƒë·ªô v·ªõi format speed pool ƒë·∫ßy k·ªãch t√≠nh v√† h·ª©ng kh·ªüi',
        'image_url': 'https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?w=600&h=400&fit=crop',
        'game_type': 'Speed Pool',
        'max_participants': 24,
        'entry_fee': 200000,
        'prize_pool': 5000000,
        'start_date': '2025-09-30',
        'registration_deadline': '2025-09-25',
        'status': 'registration_open'
      }
    ];

    int tournamentCount = 0;
    
    for (int i = 0; i < clubs.length; i++) {
      final club = clubs[i];
      final clubId = club['id'];
      final clubName = club['name'];
      
      print('   üè¢ $clubName:');
      
      // M·ªói club c√≥ 2 tournament
      final startIndex = i * 2;
      for (int j = 0; j < 2; j++) {
        final tournament = tournamentTemplates[startIndex + j];
        
        try {
          await supabase
              .from('tournaments')
              .insert({
                'club_id': clubId,
                'name': tournament['name'],
                'description': tournament['description'],
                'image_url': tournament['image_url'],
                'game_type': tournament['game_type'],
                'max_participants': tournament['max_participants'],
                'entry_fee': tournament['entry_fee'],
                'prize_pool': tournament['prize_pool'],
                'start_date': tournament['start_date'],
                'registration_deadline': tournament['registration_deadline'],
                'status': tournament['status'],
                'created_at': DateTime.now().toIso8601String(),
              });
          
          print('      ‚úÖ ${tournament['name']} - ${tournament['game_type']}');
          print('         üí∞ Prize: ${(tournament['prize_pool'] as int) / 1000000}M VND');
          tournamentCount++;
          
        } catch (e) {
          print('      ‚ùå ${tournament['name']}: L·ªói - $e');
        }
      }
      print('');
    }

    // 5. Th√™m achievements ƒëa d·∫°ng
    print('üèÖ 4. T·∫†O ACHIEVEMENTS:');
    print('========================');
    
    final achievementTemplates = [
      {
        'name': 'First Win',
        'description': 'Gi√†nh chi·∫øn th·∫Øng ƒë·∫ßu ti√™n',
        'icon_url': 'https://images.unsplash.com/photo-1591154669695-5f2a8d20c089?w=100&h=100&fit=crop',
        'category': 'milestone',
        'points': 100
      },
      {
        'name': 'Tournament Champion',
        'description': 'V√¥ ƒë·ªãch m·ªôt gi·∫£i ƒë·∫•u',
        'icon_url': 'https://images.unsplash.com/photo-1588702547919-26089e690ecc?w=100&h=100&fit=crop',
        'category': 'tournament',
        'points': 500
      },
      {
        'name': 'Perfect Game',
        'description': 'Th·ª±c hi·ªán pha b√≥ng ho√†n h·∫£o',
        'icon_url': 'https://images.unsplash.com/photo-1594736797933-d0601ba2fe65?w=100&h=100&fit=crop',
        'category': 'skill',
        'points': 200
      },
      {
        'name': 'Club MVP',
        'description': 'Th√†nh vi√™n xu·∫•t s·∫Øc nh·∫•t club',
        'icon_url': 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=100&h=100&fit=crop',
        'category': 'social',
        'points': 300
      },
    ];

    int achievementCount = 0;
    for (final achievement in achievementTemplates) {
      try {
        await supabase
            .from('achievements')
            .insert({
              'name': achievement['name'],
              'description': achievement['description'],
              'icon_url': achievement['icon_url'],
              'category': achievement['category'],
              'points': achievement['points'],
              'created_at': DateTime.now().toIso8601String(),
            });
        
        print('   ‚úÖ ${achievement['name']} - ${achievement['points']} points');
        achievementCount++;
        
      } catch (e) {
        print('   ‚ùå ${achievement['name']}: L·ªói - $e');
      }
    }

    // 6. Ki·ªÉm tra k·∫øt qu·∫£ cu·ªëi c√πng
    print('\nüîç 5. KI·ªÇM TRA K·∫æT QU·∫¢:');
    print('========================');
    
    final finalClubs = await supabase
        .from('clubs')
        .select('id, name, (club_members(count))')
        .order('name');
    
    final finalTournaments = await supabase
        .from('tournaments')
        .select('name, club_id, game_type, status')
        .order('name');
    
    final finalMembers = await supabase
        .from('user_profiles')
        .select('full_name, skill_level, specialty')
        .order('full_name');

    print('   üìä T·ªîNG K·∫æT DATA:');
    print('   üë• Th√†nh vi√™n: $memberCount users');
    print('   üèÜ Gi·∫£i ƒë·∫•u: $tournamentCount tournaments');  
    print('   üèÖ Achievements: $achievementCount achievements');
    print('');
    
    for (final club in finalClubs) {
      print('   üè¢ ${club['name']}:');
      final clubTournaments = finalTournaments.where((t) => t['club_id'] == club['id']).toList();
      print('      üë• Members: ${club['club_members'][0]['count'] ?? 0}');
      print('      üèÜ Tournaments: ${clubTournaments.length}');
      for (final tournament in clubTournaments) {
        print('         ‚Ä¢ ${tournament['name']} (${tournament['game_type']}) - ${tournament['status']}');
      }
      print('');
    }

    print('üéâ HO√ÄN T·∫§T TH√äM DATA TH√ÄNH VI√äN & GI·∫¢I ƒê·∫§U!');
    print('   Clubs gi·ªù ƒë√£ c√≥ ƒë·∫ßy ƒë·ªß members v√† tournaments v·ªõi h√¨nh ·∫£nh ƒëa d·∫°ng');
    print('   Tab "ƒë·ªëi th·ªß" s·∫Ω c√≥ nhi·ªÅu ng∆∞·ªùi ch∆°i ƒë·ªÉ match v√† tham gia gi·∫£i ƒë·∫•u!');

  } catch (e) {
    print('‚ùå L·ªñI: $e');
    exit(1);
  }

  exit(0);
}